<?php$route = '/business/';$app->get($route, function ()  use ($app,$datastore,$githubroot){	$ReturnObject = array();	if(isset($_REQUEST['query'])){ $query = $_REQUEST['query']; } else { $query = '';}	if($datastore=='mysql')		{					// Pull from MySQL		$Query = "SELECT * FROM business WHERE name LIKE '%" . $query . "%'";		$Query .= " OR description LIKE '%" . $query . "%'";		$Query .= " OR tags LIKE '%" . $query . "%'";		$Query .= " OR email LIKE '%" . $query . "%'";		$Query .= " ORDER BY name ASC";		//echo $Query . "<br />";				$LinkResult = mysql_query($Query) or die('Query failed: ' . mysql_error());		  		while ($Link = mysql_fetch_assoc($LinkResult))			{			$id = $Link['id'];			$name = $Link['name'];			$description = $Link['description'];			$url = $Link['url'];			$tags = $Link['tags'];			$streetAddress = $Link['streetAddress'];			$addressLocality = $Link['addressLocality'];			$addressRegion = $Link['addressRegion'];			$postalCode = $Link['postalCode'];			$telephone = $Link['telephone'];			$email = $Link['email'];			$map = $Link['map'];			$latitude = $Link['latitude'];			$longitude = $Link['longitude'];						$F = array();			$F['id'] = $id;			$F['name'] = $name;			$F['description'] = $description;			$F['url'] = $url;			$F['tags'] = $tags;			$F['streetAddress'] = $streetAddress;			$F['addressLocality'] = $addressLocality;			$F['addressRegion'] = $addressRegion;			$F['postalCode'] = $postalCode;			$F['telephone'] = $telephone;			$F['email'] = $email;			$F['map'] = $map;			$F['latitude'] = $latitude;			$F['longitude'] = $longitude;			array_push($ReturnObject, $F);			}		}	else 		{
				$GithubJSONURL = $githubroot . 'businesses/gh-pages/businesses.json';				$ObjectText = file_get_contents($GithubJSONURL);		$ObjectResult = json_decode($ObjectText,true);		foreach($ObjectResult as $Object){				$IncludeRecord = 1;			$id = $Object['id'];			$name = $Object['name'];			$description = $Object['description'];			$url = $Object['url'];			$tags = $Object['tags'];			$streetAddress = $Object['streetAddress'];			$addressLocality = $Object['addressLocality'];			$addressRegion = $Object['addressRegion'];			$postalCode = $Object['postalCode'];			$telephone = $Object['telephone'];			$email = $Object['email'];			$map = $Object['map'];			$latitude = $Object['latitude'];			$longitude = $Object['longitude'];				if($query!=''){			$IncludeRecord = 0;				if(strpos(strtolower($name),strtolower($query)) === 0 || strpos(strtolower($description),strtolower($query)) === 0 || strpos(strtolower($tags),strtolower($query)) === 0 || strpos(strtolower($streetAddress),strtolower($query)) === 0 || strpos(strtolower($addressRegion),strtolower($query)) === 0)					{					$IncludeRecord = 1;					}				}				if($IncludeRecord==1)				{				$F = array();				$F['id'] = $id;				$F['name'] = $name;				$F['description'] = $description;				$F['url'] = $url;				$F['tags'] = $tags;				$F['streetAddress'] = $streetAddress;				$F['addressLocality'] = $addressLocality;				$F['addressRegion'] = $addressRegion;				$F['postalCode'] = $postalCode;				$F['telephone'] = $telephone;				$F['email'] = $email;				$F['map'] = $map;				$F['latitude'] = $latitude;				$F['longitude'] = $longitude;				array_push($ReturnObject, $F);				}			}		}		$app->response()->header("Content-Type", "application/json");		echo stripslashes(format_json(json_encode($ReturnObject)));			});$route = '/business/:id';$app->get($route, function ($IncomingID)  use ($app,$datastore,$githubroot){	$ReturnObject = array();	if($datastore=='mysql')		{					// Pull from MySQL		$Query = "SELECT * FROM business WHERE id = " . $IncomingID;		//echo $Query . "<br />";				$LinkResult = mysql_query($Query) or die('Query failed: ' . mysql_error());		  		while ($Link = mysql_fetch_assoc($LinkResult))			{			$id = $Link['id'];			$name = $Link['name'];			$description = $Link['description'];			$url = $Link['url'];			$tags = $Link['tags'];			$streetAddress = $Link['streetAddress'];			$addressLocality = $Link['addressLocality'];			$addressRegion = $Link['addressRegion'];			$postalCode = $Link['postalCode'];			$telephone = $Link['telephone'];			$email = $Link['email'];			$map = $Link['map'];			$latitude = $Link['latitude'];			$longitude = $Link['longitude'];						$F = array();			$F['id'] = $id;			$F['name'] = $name;			$F['description'] = $description;			$F['url'] = $url;			$F['tags'] = $tags;			$F['streetAddress'] = $streetAddress;			$F['addressLocality'] = $addressLocality;			$F['addressRegion'] = $addressRegion;			$F['postalCode'] = $postalCode;			$F['telephone'] = $telephone;			$F['email'] = $email;			$F['map'] = $map;			$F['latitude'] = $latitude;			$F['longitude'] = $longitude;			array_push($ReturnObject, $F);						}					}	else 		{		$GithubJSONURL = $githubroot . 'businesses/gh-pages/businesses.json';				$ObjectText = file_get_contents($GithubJSONURL);		$ObjectResult = json_decode($ObjectText,true);			foreach($ObjectResult as $Object){				$IncludeRecord = 0;						$id = $Object['id'];			$name = $Object['name'];			$description = $Object['description'];			$url = $Object['url'];			$tags = $Object['tags'];			$streetAddress = $Object['streetAddress'];			$addressLocality = $Object['addressLocality'];			$addressRegion = $Object['addressRegion'];			$postalCode = $Object['postalCode'];			$telephone = $Object['telephone'];			$email = $Object['email'];			$map = $Object['map'];			$latitude = $Object['latitude'];			$longitude = $Object['longitude'];				if($IncomingID==$id)				{				$IncludeRecord=1;				}				if($IncludeRecord==1)				{				$F = array();				$F['id'] = $id;				$F['name'] = $name;				$F['description'] = $description;				$F['url'] = $url;				$F['tags'] = $tags;				$F['streetAddress'] = $streetAddress;				$F['addressLocality'] = $addressLocality;				$F['addressRegion'] = $addressRegion;				$F['postalCode'] = $postalCode;				$F['telephone'] = $telephone;				$F['email'] = $email;				$F['map'] = $map;				$F['latitude'] = $latitude;				$F['longitude'] = $longitude;				array_push($ReturnObject, $F);				}			}		}		$app->response()->header("Content-Type", "application/json");		echo stripslashes(format_json(json_encode($ReturnObject)));	});?>